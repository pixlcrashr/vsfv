generator client {
  provider        = "prisma-client"
  output          = "../src/lib/prisma/generated"
  previewFeatures = ["driverAdapters", "queryCompiler"]
  binaryTargets = ["native", "linux-musl", "linux-musl-arm64-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DB_URL")
}

model account_group_assignments {
  id               String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  account_group_id String         @db.Uuid
  account_id       String         @db.Uuid
  negate           Boolean        @default(false)
  updated_at       DateTime       @default(now()) @db.Timestamp(6)
  created_at       DateTime       @default(now()) @db.Timestamp(6)
  account_groups   account_groups @relation(fields: [account_group_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  accounts         accounts       @relation(fields: [account_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([account_group_id, account_id], map: "idx_account_group_id_account_id")
  @@index([negate], map: "idx_account_group_assignments_negate")
}

model account_groups {
  id                             String                           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  display_name                   String                           @default("")
  display_description            String                           @default("")
  updated_at                     DateTime                         @default(now()) @db.Timestamp(6)
  created_at                     DateTime                         @default(now()) @db.Timestamp(6)
  account_group_assignments      account_group_assignments[]
  view_account_group_assignments view_account_group_assignments[]

  @@index([display_description], map: "idx_account_groups_display_description")
  @@index([display_name], map: "idx_account_groups_display_name")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model accounts {
  id                              String                           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  parent_account_id               String?                          @db.Uuid
  display_name                    String                           @default("")
  display_code                    String                           @default("")
  display_description             String                           @default("")
  updated_at                      DateTime                         @default(now()) @db.Timestamp(6)
  created_at                      DateTime                         @default(now()) @db.Timestamp(6)
  account_group_assignments       account_group_assignments[]
  accounts                        accounts?                        @relation("accountsToaccounts", fields: [parent_account_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  other_accounts                  accounts[]                       @relation("accountsToaccounts")
  budget_revision_account_values  budget_revision_account_values[]
  transactions                    transactions[]
  view_account_assignments        view_account_assignments[]
  transaction_account_assignments transaction_account_assignments[]
  is_archived                     Boolean                          @default(false)

  @@index([display_code], map: "idx_accounts_display_code")
  @@index([display_name], map: "idx_accounts_display_name")
  @@index([parent_account_id], map: "idx_accounts_parent_account_id")
}

model budget_revision_account_values {
  id                 String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  budget_revision_id String           @db.Uuid
  account_id         String           @db.Uuid
  value              Decimal          @default(0) @db.Decimal
  updated_at         DateTime         @default(now()) @db.Timestamp(6)
  created_at         DateTime         @default(now()) @db.Timestamp(6)
  accounts           accounts         @relation(fields: [account_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  budget_revisions   budget_revisions @relation(fields: [budget_revision_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([account_id], map: "idx_budget_revision_account_values_account_id")
  @@index([budget_revision_id], map: "idx_budget_revision_account_values_budget_id")
  @@index([value], map: "idx_budget_revision_account_values_value")
}

model budget_revisions {
  id                             String                           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  budget_id                      String                           @db.Uuid
  date                           DateTime                         @db.Timestamp(6)
  display_description            String                           @default("")
  updated_at                     DateTime                         @default(now()) @db.Timestamp(6)
  created_at                     DateTime                         @default(now()) @db.Timestamp(6)
  budget_revision_account_values budget_revision_account_values[]
  budgets                        budgets                          @relation(fields: [budget_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([budget_id], map: "idx_budget_revisions_budget_id")
  @@index([date], map: "idx_budget_revisions_date")
}

model budgets {
  id                      String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  display_name            String                    @default("")
  display_description     String                    @default("")
  is_closed               Boolean                   @default(false)
  period_start            DateTime                  @db.Timestamp(6)
  period_end              DateTime                  @db.Timestamp(6)
  updated_at              DateTime                  @default(now()) @db.Timestamp(6)
  created_at              DateTime                  @default(now()) @db.Timestamp(6)
  budget_revisions        budget_revisions[]
  view_budget_assignments view_budget_assignments[]

  @@index([display_name], map: "idx_budgets_display_name")
}

model import_sources {
  id                  String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  display_name        String                  @default("")
  display_description String                  @default("")
  period_start        DateTime                @default(now()) @db.Date
  updated_at          DateTime                @default(now()) @db.Timestamp(6)
  created_at          DateTime                @default(now()) @db.Timestamp(6)
  transactionAccounts transaction_accounts[]
  importSourcePeriods import_source_periods[]
}

model import_source_periods {
  id               String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  import_source_id String          @db.Uuid
  year             Int             @default(0)
  is_closed        Boolean         @default(false)
  updated_at       DateTime        @default(now()) @db.Timestamp(6)
  created_at       DateTime        @default(now()) @db.Timestamp(6)
  import_sources   import_sources? @relation(fields: [import_source_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([import_source_id, year])
}

model transaction_accounts {
  id                                                                            String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  code                                                                          String          @unique @db.VarChar(64)
  import_source_id                                                              String          @db.Uuid
  display_name                                                                  String          @default("")
  display_description                                                           String          @default("")
  updated_at                                                                    DateTime        @default(now()) @db.Timestamp(6)
  created_at                                                                    DateTime        @default(now()) @db.Timestamp(6)
  transactions_transactions_credit_transaction_account_idTotransaction_accounts transactions[]  @relation("transactions_credit_transaction_account_idTotransaction_accounts")
  transactions_transactions_debit_transaction_account_idTotransaction_accounts  transactions[]  @relation("transactions_debit_transaction_account_idTotransaction_accounts")
  import_sources                                                                import_sources? @relation(fields: [import_source_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([code, import_source_id])
  @@index([code], map: "idx_transaction_accounts_code")
  @@index([display_name], map: "idx_transaction_accounts_display_name")
}

model transactions {
  id                                                                                    String                           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  credit_transaction_account_id                                                         String                           @db.Uuid
  debit_transaction_account_id                                                          String                           @db.Uuid
  amount                                                                                Decimal                          @db.Decimal
  description                                                                           String                           @default("")
  reference                                                                             String                           @default("")
  assigned_account_id                                                                   String?                          @db.Uuid
  booked_at                                                                             DateTime                         @default(now()) @db.Date
  document_date                                                                         DateTime                         @default(now()) @db.Date
  updated_at                                                                            DateTime                         @default(now()) @db.Timestamp(6)
  created_at                                                                            DateTime                         @default(now()) @db.Timestamp(6)
  custom_id                                                                             String                           @default("")
  accounts                                                                              accounts?                        @relation(fields: [assigned_account_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  transaction_accounts_transactions_credit_transaction_account_idTotransaction_accounts transaction_accounts             @relation("transactions_credit_transaction_account_idTotransaction_accounts", fields: [credit_transaction_account_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  transaction_accounts_transactions_debit_transaction_account_idTotransaction_accounts  transaction_accounts             @relation("transactions_debit_transaction_account_idTotransaction_accounts", fields: [debit_transaction_account_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  transaction_account_assignments                                                       transaction_account_assignments[]

  @@unique([custom_id])
  @@unique([credit_transaction_account_id, debit_transaction_account_id, amount, description, reference, booked_at, document_date])
}

model transaction_account_assignments {
  id             String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  transaction_id String       @db.Uuid
  account_id     String       @db.Uuid
  value          Decimal      @db.Decimal
  created_at     DateTime     @default(now()) @db.Timestamp(6)
  updated_at     DateTime     @default(now()) @db.Timestamp(6)
  transactions   transactions @relation(fields: [transaction_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  accounts       accounts     @relation(fields: [account_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([transaction_id], map: "idx_transaction_account_assignments_transaction_id")
  @@index([account_id], map: "idx_transaction_account_assignments_account_id")
}

model view_account_assignments {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  view_id    String   @db.Uuid
  account_id String   @db.Uuid
  created_at DateTime @default(now()) @db.Timestamp(6)
  accounts   accounts @relation(fields: [account_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  views      views    @relation(fields: [view_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([view_id, account_id])
  @@index([account_id], map: "idx_view_account_assignments_account_id")
  @@index([view_id], map: "idx_view_account_assignments_view_id")
}

model view_account_group_assignments {
  id               String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  view_id          String         @db.Uuid
  account_group_id String         @db.Uuid
  created_at       DateTime       @default(now()) @db.Timestamp(6)
  account_groups   account_groups @relation(fields: [account_group_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  views            views          @relation(fields: [view_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([view_id, account_group_id])
  @@index([account_group_id], map: "idx_view_account_group_assignments_account_group_id")
  @@index([view_id], map: "idx_view_account_group_assignments_view_id")
}

model view_budget_assignments {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  view_id    String   @db.Uuid
  budget_id  String   @db.Uuid
  created_at DateTime @default(now()) @db.Timestamp(6)
  budgets    budgets  @relation(fields: [budget_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  views      views    @relation(fields: [view_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([view_id, budget_id])
  @@index([budget_id], map: "idx_view_budget_assignments_budget_id")
  @@index([view_id], map: "idx_view_budget_assignments_view_id")
}

model views {
  id                             String                           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  display_name                   String                           @default("")
  display_description            String                           @default("")
  updated_at                     DateTime                         @default(now()) @db.Timestamp(6)
  created_at                     DateTime                         @default(now()) @db.Timestamp(6)
  view_account_assignments       view_account_assignments[]
  view_account_group_assignments view_account_group_assignments[]
  view_budget_assignments        view_budget_assignments[]

  @@index([display_description], map: "idx_views_display_description")
  @@index([display_name], map: "idx_views_display_name")
}

model report_templates {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  display_name String   @default("")
  template     String   @default("")
  updated_at   DateTime @default(now()) @db.Timestamp(6)
  created_at   DateTime @default(now()) @db.Timestamp(6)
}

model reports {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  display_name String   @default("")
  data         Bytes
  created_at   DateTime @default(now()) @db.Timestamp(6)
}

model users {
  id              String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email           String           @unique
  name            String
  picture         String?
  created_at      DateTime         @default(now()) @db.Timestamp(6)
  updated_at      DateTime         @default(now()) @db.Timestamp(6)
  user_identities user_identities[]

  @@index([email], map: "idx_users_email")
}

model user_identities {
  id               String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id          String   @db.Uuid
  provider         String
  provider_user_id String
  created_at       DateTime @default(now()) @db.Timestamp(6)
  updated_at       DateTime @default(now()) @db.Timestamp(6)
  users            users    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([provider, provider_user_id])
  @@index([user_id], map: "idx_user_identities_user_id")
  @@index([provider], map: "idx_user_identities_provider")
}

model user_groups {
  id          String   @id
  name        String
  description String   @default("")
  is_system   Boolean  @default(false)
  is_default  Boolean  @default(false)
  created_at  DateTime @default(now()) @db.Timestamp(6)
  updated_at  DateTime @default(now()) @db.Timestamp(6)

  @@index([name], map: "idx_user_groups_name")
}

model casbin_rule {
  id    String  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  ptype String
  v0    String?
  v1    String?
  v2    String?
  v3    String?
  v4    String?
  v5    String?

  @@index([ptype], map: "idx_casbin_rule_ptype")
  @@index([v0], map: "idx_casbin_rule_v0")
  @@index([v1], map: "idx_casbin_rule_v1")
  @@index([v2], map: "idx_casbin_rule_v2")
}

model settings {
  id            String   @id
  type          String   @db.VarChar(16)
  value_float   Float?
  value_int     BigInt?
  value_text    String?
  value_bool    Boolean?
  value_decimal Decimal? @db.Decimal
  value_uuid    String?  @db.Uuid
  created_at    DateTime @default(now()) @db.Timestamp(6)
  updated_at    DateTime @default(now()) @db.Timestamp(6)

  @@index([type], map: "idx_settings_type")
}

